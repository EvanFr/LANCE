{
    "id": "b3e5e48d-6a95-4d4e-b6df-66b80caa14fa",
    "created_at": "2023-06-05T02:07:46.17595Z",
    "updated_at": "2024-11-22T02:03:07.199755Z",
    "deleted_at": null,
    "sha1_hash": "405e9a4f5a18571f5bb2e27cc851c369c8f6d04c",
    "title": "2023-05-29 - GobRAT malware written in Go language targeting Linux routers",
    "authors": "",
    "file_creation_date": "2023-06-04T13:51:52Z",
    "file_modification_date": "2023-06-04T13:51:52Z",
    "file_size": 2308657,
    "plain_text": "GobRAT malware written in Go language targeting Linux\nrouters\nblogs.jpcert.or.jp/en/2023/05/gobrat.html\n\n\u5897\u6e15 \u7dad\u6469(Yuma Masubuchi)\nMay 29, 2023\nTool\n\nEmail\nJPCERT/CC has confirmed attacks that infected routers in Japan with malware around\nFebruary 2023. This blog article explains the details of the attack confirmed by JPCERT/CC\nand GobRAT malware, which was used in the attack.\n\nAttack flow up to malware execution\nInitially, the attacker targets a router whose WEBUI is open to the public, executes scripts\npossibly by using vulnerabilities, and finally infects the GobRAT. Figure 1 shows the flow of\nthe attack until GobRAT infects the router.\n\n1/11\n\nFigure 1: Attack Flow\n\nLoader Script works as a loader, containing functions such as generating various scripts\nand downloading GobRAT. The SSH public key, which is assumed to be used for the\nbackdoor, is hard-coded in the script. In addition, since Loader Script uses crontab to\nregister the file path of Start Script for persistence, GobRAT does not have such function.\nThe functions of Loader Script are as follows:\nDisable Firewall function\nDownload GobRAT for the target machine's architecture\nCreate Start Script and make it persistent\nCreate and run Daemon Script.\nRegister a SSH public key in /root/.ssh/authorized_keys\nFigure 2 is the code of Start Script that executes GobRAT. The script is unique in that it\nwrites the startup time to a file named restart.log. In addition, this script executes GobRAT\nunder the file name apached to make it look like a legitimate process.\n\n2/11\n\nFigure 2: Start Script\n\nFigure 3 is the code of Daemon Script. This script checks whether Start Script is running or\nnot every 20 seconds, and if not, it starts the script. This code has been possibly prepared in\ncase Start Script is terminated unexpectedly.\n\nFigure 3: Daemon Script\n\nGobRAT Overview\nGobRAT is a RAT written in Go language and communicates with C2 server via TLS and\nexecutes various commands. It is packed with UPX version 4 series, and samples for various\narchitectures such as ARM, MIPS, x86, and x86-64 have been confirmed. GobRAT performs\nthe following checks at startup and keeps the information within the sample itself.\nIP address and MAC address of itself\nUptime by uptime command\nNetwork communication status by /proc/net/dev\n3/11\n\nThe following sections describes the GobRAT\u2019s communication method, encryption method,\nand commands to be executed.\n\nCommunication method\nGobRAT uses TLS to send and receive data with its C2 server. Figure 4 shows an example\nof communication with the C2 server. The first 4 bytes indicate the size of the data, and the\nrest is gob[1] data. gob is a data serialization protocol available only in Go language.\nGobRAT uses gob for receiving commands and sending the results of command execution.\n\nFigure 4: Example of communication content\n\nGobRAT defines gob data as a PACKAGE structure in the sample as follows.\ntype PACKAGE struct {\nType uint8\nBotCount uint16\nBotList []string\nParamLength uint16\nParam map[string]string\nContent []uint8\n}\n\n// CommandID\n// Parameter\n// Command Parameter\n// Length of Param\n// Command Parameter\n// Command Parameter, Command Execution Result, etc\n\nThe fields used are different depending on the type of command, and string arrays, maps,\nand binary data are supported so that various types of parameters can be passed. In\naddition, while binary data can be stored in Content of the PACKAGE structure, map data\nwith string is converted to binary data by encoding it with the json.Marshal function. The\nPACKAGE structure is used in various ways depending on the command, such as storing the\ndata in Content, or converting the defined structure to binary data in the same way and\nstoring it in Content.\n\n4/11\n\nEncryption Method\nStrings such as C2 and Linux commands are encrypted and stored in the sample. Figure 5\nshows the GobRAT's decryption function. AES128 CTR mode is used to decrypt strings, and\nthe key and IV are hard-coded in the sample. The same key\n(050CFE3706380723433807193E03FE2F) and IV (\"12345678abcdefgh\") are used in all\nthe confirmed samples. In addition, as shown in Figure 6, the codes that have probably been\ndeveloped by the attacker, such as this decryption function, has a unique folder structure like\naaa.com/bbb/me~.\n\nFigure 5: String decryption function\n\n5/11\n\nFigure 6: Characteristic folder structure\n\nCommands executed\nGobRAT has 22 commands that are executed by the commands from the C2 server, and we\nhave identified the following commands. Since the malware targets routers, you can see that\nmost functions are related to communication, such as frpc, socks5, and reconfiguration of\nC2. See Appendix A for command details.\nObtain machine Information\nExecute reverse shell\nRead/write files\nConfigure new C2 and protocol\nStart socks5\nExecute file in /zone/frpc\nAttempt to login to sshd, Telnet, Redis, MySQL, PostgreSQL services running on\nanother machine\n6/11\n\nGobRAT Analysis Tools\nSince GobRAT uses gob for communication, if you want to emulate its communication with\nC2 to check commands, you need to create a program using Go language. Our C2\nemulation tool that supports GobRAT analysis is available on GitHub. Please download it\nfrom the following webpage for your analysis.\nJPCERTCC/aa-tools/GobRAT-Analysis - GitHub\nhttps://github.com/JPCERTCC/aa-tools/tree/master/GobRAT-Analysis\n\nIn Closing\nIn recent years, different types of malware using Go language have been confirmed, and the\nGobRAT malware confirmed this time uses gob, which can only be handled by Go language,\nfor communication. Please continuously beware of malware that infects routers, not limited to\nGobRAT, since they are difficult to detect. Please refer to Appendix B for C2 of the malware,\nAppendix C for the hash value of the script, and Appendix D for the hash value of the\nmalware.\nYuma Masubuchi\nTranslated by Takumi Nakano\nAppendix A: Commands\nTableA: GobRAT commands\nValue\n\nContents\n\n0x0\n\nUpdate json data held in malware and acquire update results\n\n0x1\n\nRetrieve json data held in malware\n\n0x3\n\nStart reverse shell\n\n0x4\n\nEnd of reverse shell connection\n\n0x6\n\nConfirmation of reverse shell connection\n\n0x7\n\nExecute shell command for daemon\n\n0x8\n\nExecute shell command\n\n0xD\n\nRead/write specified file\n\n0x10,0x11\n\nRead/write specified file\n\n0x16\n\nObtain various machine information such as df command\n\n7/11\n\nValue\n\nContents\n\n0x17\n\nSet new communication channel for TCP\n\n0x18\n\nExecute SOCKS5 proxy with specified port and password\n\n0x19\n\nExecute SOCKS5 proxy on specified port\n\n0x1a\n\nNew communication channel setting for UDP\n\n0x1b\n\nExecute frpc after executing SOCKS5 proxy on port 5555\n\n0x1f\n\nCheck for the existence of the specified file\n\n0x25\n\nLogin attempts for SSH, telenet, redis, mysql, postgres\n\n0x27\n\nConfiguration of specified goroutine\n\n0x2a\n\nScan to HTTP/HTTPS service of specified IP\n\n0x2D\n\nDictionary attack to HTTP/HTTPS service of specified IP\n\n0x30\n\nC2 configuration related\n\n0x31\n\nDDoS attacks on SYN, TCP, UDP, HTTP, ICMP\n\nAppendix B: C2\nhttps[:]//su.vealcat[.]com\nhttp[:]//su.vealcat[.]com:58888\nhttps[:]//ktlvz.dnsfailover[.]net\nhttp[:]//ktlvz.dnsfailover[.]net:58888\nsu.vealcat[.]com\nktlvz.dnsfailover[.]net\nwpksi.mefound[.]com\nAppendix C: Hash values of the scripts\n060acb2a5df6560acab9989d6f019fb311d88d5511f3eda0effcbd9fc6bd12bb\nfeaef47defd8b4988e09c8b11967e20211b54e16e6df488780e2490d7c7fa02a\n3e44c807a25a56f4068b5b8186eee5002eed6f26d665a8b791c472ad154585d1\n60bcd645450e4c846238cf0e7226dc40c84c96eba99f6b2cffcd0ab4a391c8b3\nAppendix D: Hash values of the malware\na8b914df166fd0c94106f004e8ca0ca80a36c6f2623f87a4e9afe7d86b5b2e3a\naeed77896de38802b85a19bfcb8f2a1d567538ddc1b045bcdb29cb9e05919b60\n6748c22d76b8803e2deb3dad1e1fa7a8d8ff1e968eb340311fd82ea5d7277019\ne133e05d6941ef1c2e3281f1abb837c3e152fdeaffefde84ffe25338fe02c56d\n8/11\n\n43dc911a2e396791dc5a0f8996ae77ac527add02118adf66ac5c56291269527e\naf0292e4de92032ede613dc69373de7f5a182d9cbba1ed49f589ef484ad1ee3e\n2c1566a2e03c63b67fbdd80b4a67535e9ed969ea3e3013f0ba503cfa58e287e3\n98c05ae70e69e3585fc026e67b356421f0b3d6ab45b45e8cc5eb35f16fef130c\n300a92a67940cfafeed1cf1c0af25f4869598ae58e615ecc559434111ab717cd\na363dea1efda1991d6c10cc637e3ab7d8e4af4bd2d3938036f03633a2cb20e88\n0c280f0b7c16c0d299e306d2c97b0bff3015352d2b3299cf485de189782a4e25\nf962b594a847f47473488a2b860094da45190738f2825d82afc308b2a250b5fb\n4ceb27da700807be6aa3221022ef59ce6e9f1cda52838ae716746c1bbdee7c3d\n3e1a03f1dd10c3e050b5f455f37e946c214762ed9516996418d34a246daed521\n3bee59d74c24ef33351dc31ba697b99d41c8898685d143cd48bccdff707547c0\nc71ff7514c8b7c448a8c1982308aaffed94f435a65c9fdc8f0249a13095f665e\nReferences\n[1] Gobs of data\nhttps://go.dev/blog/gob\n\nEmail\nAuthor\n\n\u5897\u6e15 \u7dad\u6469(Yuma Masubuchi)\nYuma has been engaged in malware analysis and coordination of cyber security incidents in\nJPCERT/CC Incident Response Group since November 2020.\nWas this page helpful?\n0 people found this content helpful.\nIf you wish to make comments or ask questions, please use this form.\nThis form is for comments and inquiries. For any questions regarding specific commercial\nproducts, please contact the vendor.\nplease change the setting of your browser to set JavaScript valid. Thank you!\n\nRelated articles\n\n9/11\n\nAttack Trends Related to DangerousPassword\n\nActivity Targeting Crypto Asset Exchangers for Parallax RAT Infection\n\nAutomating Malware Analysis Operations (MAOps)\n\nYamaBot Malware Used by Lazarus\n\n10/11\n\nVSingle malware that obtains C2 server information from GitHub\nBack\nTop\n\n11/11",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-05-29 - GobRAT malware written in Go language targeting Linux routers.pdf"
    ],
    "report_names": [
        "2023-05-29 - GobRAT malware written in Go language targeting Linux routers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1685930866175,
    "ts_updated_at": 1732240987199,
    "ts_creation_date": 1685886712000,
    "ts_modification_date": 1685886712000,
    "files": {
        "pdf": "https://archive.orkl.eu/405e9a4f5a18571f5bb2e27cc851c369c8f6d04c.pdf",
        "text": "https://archive.orkl.eu/405e9a4f5a18571f5bb2e27cc851c369c8f6d04c.txt",
        "img": "https://archive.orkl.eu/405e9a4f5a18571f5bb2e27cc851c369c8f6d04c.jpg"
    }
}